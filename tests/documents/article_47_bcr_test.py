from gdpr_rag.documents.article_47_bcr import Article_47_BCR

import sys
sys.path.append('E:/Code/chat/gdpr')


def test_regression():
    path_to_manual_as_csv_file = "./inputs/documents/article_47_bcr.csv"

    doc = Article_47_BCR(path_to_manual_as_csv_file)
    section = "1.3"
    assert doc.get_heading(section) == "1 INTRODUCTION"
    assert doc.get_text(section, add_markdown_decorators = False) == '1 INTRODUCTION\nOn 11 April 2018, the Article 29 Working Party (thereinafter "WP29") adopted Recommendations on the Standard Application for Approval of Controller Binding Corporate Rules for the Transfer of Personal Data (hereinafter: "WP264"). The European Data Protection Board (hereinafter "EDPB") endorsed WP256 rev.01 on 25 May 2018. These Recommendations repeal and replace WP264, while in substance building on it.'

    section = "3.3.1"
    assert doc.get_heading(section) == '3 ELEMENTS AND PRINCIPLES TO BE FOUND IN BCR-C\n3.3 EFFECTIVENESS'
    assert doc.get_text(section, add_markdown_decorators = False) == '3 ELEMENTS AND PRINCIPLES TO BE FOUND IN BCR-C\n3.3 EFFECTIVENESS\nThe BCR-C must state that appropriate and up-to- date training on the BCR-C is provided to personnel that have permanent or regular access to personal data, who are involved in the collection of data or in the development of tools used to process personal data.<br> The training programme, including its materials, has to be developed to a sufficiently elaborate degree before the BCR-C are approved. In this regard it should be recalled that no transfer can be made under the BCR-C to a BCR member unless the member is effectively bound by the BCR-C and can deliver compliance (see Section 7.1) which includes that appropriate training on the BCR-C can effectively be provided to the employees of the respective member. <br>Training intervals should be specified in the BCR-C. <br>Training should cover, among others, procedures of managing requests for access to personal data by public authorities. <br>The SAs evaluating the BCR-C may ask for examples and explanations of the training programme during the application procedure.'
    
    
    section = "3.5.4.1"
    assert doc.get_heading(section) == '3 ELEMENTS AND PRINCIPLES TO BE FOUND IN BCR-C\n3.5 DATA PROTECTION SAFEGUARDS'
    assert doc.get_text(section, add_markdown_decorators = False) == '3 ELEMENTS AND PRINCIPLES TO BE FOUND IN BCR-C\n3.5 DATA PROTECTION SAFEGUARDS\nThe BCR C shall contain a clear commitment that BCR members will use the BCR-C as a tool for transfers only where they have assessed that the law and practices in the third country of destination applicable to the processing of the personal data by the BCR member acting as data importer, including any requirements to disclose personal data or measures authorising access by public authorities, do not prevent it from fulfilling its obligations under these BCR-C. <br>The BCR-C should further specify that this is based on the understanding that laws and practices that respect the essence of the fundamental rights and freedoms, and do not exceed what is necessary and proportionate in a democratic society[^24] to safeguard one of the objectives listed in Article 23(1) GDPR, are not in contradiction with the BCR-C.<br> The BCR-C should also contain a commitment that, in assessing the laws and practices of the third country which may affect the respect of the commitments contained in the BCR-C, the BCR members have taken due account, in particular, of the following elements: <ol type="i"> <li>The specific circumstances of the transfers or set of transfers, and of any envisaged onward transfers within the same third country or to another third country, including: <ul><li> purposes for which the data are transferred and processed (e.g. marketing, HR, storage, IT support, clinical trials); </li><li> types of entities involved in the processing (the data importer and any further recipient of any onward transfer); </li><li> economic sector in which the transfer or set of transfers occur; </li><li> categories and format of the personal data transferred; </li><li> location of the processing, including storage; and </li><li> transmission channels used. </ul> </li><li> The laws and practices of the third country of destination relevant in light of the circumstances of the transfer[^25], including those requiring to disclose data to public authorities or authorising access by such authorities and those providing for access to these data during the transit between the country of the data exporter and the country of the data importer, as well as the applicable limitations and safeguards[^26]. </li><li> Any relevant contractual, technical or organisational safeguards put in place to supplement the safeguards under the BCR-C, including measures applied during the transmission and to the processing of the personal data in the country of destination. </li></ol> The BCR-C should also contain a commitment that where any safeguards in addition to those envisaged under the BCR-C should be put in place, the Liable BCR member(s), and the relevant Privacy officer or Function will be informed and involved in such assessment. <br>The BCR-C should contain also an obligation for the BCR members to document appropriately such assessment, as well as the supplementary measures selected and implemented. They should make such documentation available to the competent SAs upon request. <br>The BCR-C should oblige any BCR member acting as data importer to promptly notify the data exporter if, when using these BCR-C as a tool for transfers, and for the duration of the BCR membership, it has reasons to believe that it is or has become subject to laws or practices that would prevent it from fulfilling its obligations under the BCR-C, including following a change in the laws in the third country or a measure (such as a disclosure request). This information should also be provided to the Liable BCR member(s). <br>Upon verification of such notification, the BCR member acting as data exporter, along with the Liable BCR member(s) and the relevant Privacy officer or Function, should commit to promptly identify supplementary measures (e.g. technical or organisational measures to ensure security and confidentiality) to be adopted by the BCR member acting as data exporter and/or data importer, in order to enable them to fulfil their obligations under the BCR-C. The same applies if a BCR member acting as data exporter has reasons to believe that a BCR member acting as its data importer can no longer fulfil its obligations under this BCR-C. <br>Where the BCR member acting as data exporter, along with the Liable BCR member(s) and the relevant Privacy officer or Function, assesses that the BCR-C – even if accompanied by supplementary measures – cannot be complied with for a transfer or set of transfers, or if instructed by the Competent SAs, it commits to suspend the transfer or set of transfers at stake, as well as all transfers for which the same assessment and reasoning would lead to a similar result, until compliance is again ensured or the transfer is ended. <br>The BCR-C should contain a commitment that following such a suspension, the BCR member acting as data exporter has to end the transfer or set of transfers if the BCR C cannot be complied with and compliance with the BCR is not restored within one month of suspension. In this case, personal data that have been transferred prior to the suspension, and any copies thereof, should, at the choice of the BCR member acting as data exporter, be returned to it or destroyed in their entirety. <br>The BCR-C should contain a commitment that the Liable BCR member(s) and the relevant Privacy officer or Function will inform all other BCR members of the assessment carried out and of its results, so that the identified supplementary measures will be applied in case the same type of transfers is carried out by any other BCR member or, where effective supplementary measures could not be put in place, the transfers at stake are suspended or ended. <br>The BCR-C needs to include a duty for data exporters to monitor, on an ongoing basis, and where appropriate in collaboration with data importers, developments in the third countries to which the data exporters have transferred personal data that could affect the initial assessment of the level of protection and the decisions taken accordingly on such transfers.\n\n  \n[^24]: See EDPB Recommendations 02/2020 on the European Essential Guarantees for surveillance measures.  \n[^25]: As regards the assessment of the impact of the laws and practices of the third countries, please see EDPB Recommendations 01/2020 on measures that supplement transfer tools to ensure compliance with the EU level of protection of personal data.  \n[^26]: As regards the impact of such laws and practices on compliance with the BCR, different elements may be considered as part of an overall assessment. Such elements may include relevant and documented practical experience with prior instances of requests for disclosure from public authorities, or the absence of such requests, covering a sufficiently representative time-frame. This refers in particular to internal records or other documentation, drawn up on a continuous basis in accordance with due diligence and certified at senior management level, provided that this information can be lawfully shared with third parties. Where this practical experience is relied upon to conclude that the data importer will not be prevented from complying with the BCR, it needs to be supported by other relevant, objective elements, and it is for the BCR members to consider carefully whether these elements together carry sufficient weight, in terms of their reliability and representativeness, to support this conclusion. In particular, the BCR members have to take into account whether their practical experience is corroborated and not contradicted by publicly available or otherwise accessible, reliable information on the existence or absence of requests within the same sector and/or the application of the law in practice, such as case law and reports by independent oversight bodies.'


    section = "Application. Annex 1"
    assert doc.get_heading(section) == 'Application. Annex 1 COPY OF THE  BCR-C'
    assert doc.get_text(section, add_markdown_decorators = False) == 'Application. Annex 1 COPY OF THE  BCR-C\nPlease attach a copy of your BCR-C to your application. Please note that all mandatory content needs to be included in the BCR documents (in the core document(s) or its annexes), while "supporting documents" (i.e. documents that are not part of the BCR) may only be submitted for reasons of further explanation[^13].\n\n  \n[^13]: Please note that any documents that are submitted may be subject to access requests based on freedom of information legislation, as applicable.'

    
    
    section = "Analysis"
    assert doc.get_heading(section) == ''
    assert doc.get_text(section, add_markdown_decorators = False) == 'Points that need to be addressed in a binding corporate resolution for controllers (BCR-C) are:\n3.1.1: Duty to respect the BCR-C (Article 47(1)(a) and (2)(c) GDPR [^15]).\n3.1.2: Explanation of how the BCR-C are internally[^16] made binding on the BCR members, and on their employees (Article 47(1)(a) and (2)(c) GDPR).\n3.1.3.1: Creation of third-party beneficiary rights that are enforceable by data subjects (Article 47(1)(b), (2)(c) and (e) GDPR).\n3.1.3.2: Right to judicial remedies, redress and compensation for data subjects (Article 47(2)(e) and Articles 77 to 82 GDPR).\n3.1.4: One or more BCR member(s) in the EEA with delegated data protection responsibility accept liability for paying compensation to data subjects and remedying breaches of the BCR-C (hereinafter "Liable BCR Member(s)") (Article 47(2)(f) GDPR).\n3.1.5: The Liable BCR member(s) has sufficient assets (Article 70(1)(i) GDPR).\n3.1.6: The burden of proof lies with the Liable BCR member(s) (Article 47(2)(f) GDPR).\n3.1.7: Easy access to the BCR-C for data subjects (Article 47(2)(g) GDPR).\n3.2.1: Description of the material scope of the BCR-C (Article 47(2)(b) GDPR).\n3.2.2: List of BCR members, and description of the geographical scope of the BCR-C (Article 47(2)(a) GDPR).\n3.3.1: Suitable training programme (Article 47(2)(n) GDPR).\n3.3.2: Complaint handling process for the BCR-C (Article 47(2)(i) and Article 12(3) GDPR).\n3.3.3: Audit programme covering the BCR-C (Article 47(2)(j) and (l) and Article 38(3) GDPR).\n3.3.4: Creation of a network of data protection officers (DPOs) or appropriate staff for monitoring compliance with the BCR-C (Article 47(2)(h) and Article 38(3) GDPR).\n3.4.1: Duty to cooperate with Competent SAs (Article 47(2)(l) GDPR and Article 31 GDPR).\n3.5.1.1: Description of the data protection principles (Article 47(2)(d) GDPR and Article 5 GDPR).\n3.5.1.2: Lawfulness of processing (Article 47(2)(d), Article 5(1)(a), and Articles 6 and 9 GDPR).\n3.5.1.3: Security and personal data breach notifications (Article 47(2)(d) and Articles 32 to 34 GDPR).\n3.5.1.4: Restrictions on onward transfers (Article 47(2)(d) GDPR and Article 44 GDPR).\n3.5.2: Rights of data subjects (Article 47(2)(e), Articles 12 to 19 and 21 to 22 GDPR).\n3.5.3: Accountability and other tools (Article 47(2)(d), and Articles 30, 35-36 GDPR).\n3.5.4.1: Local laws and practices affecting compliance with the BCR-C[^23] (Article 47(2)(m) GDPR).\n3.5.4.2: Obligations of the data importer in case of government access requests (Article 47(2)(m) GDPR).\n3.6.1: Termination (Article 70(1)(i) GDPR).\n3.7.1: Non-Compliance (Article 70(1)(i) GDPR).\n3.8.1: Process for updating the BCR-C (Article 47(2)(k) GDPR).\n3.9.1: List of definitions (Article 70(1)(i) GDPR).\n\n  \n[^15]: References in this paper to GDPR provisions do not imply that GDPR applies directly to the BCR members acting as data importers, but should rather be understood as the threshold for commitments that need to be made in a BCR. If the BCR make reference to GDPR provisions, possible wording to indicate this might e.g. be "in line with Article X of the GDPR", "… as those provided for by Article X of the GDPR".  \n[^16]: Please note that, besides having internal binding nature (i.e. binding effect on the BCR members and their employees), the BCR-C must also have an external binding effect in the sense of providing legal enforceability (of certain parts of the BCR-C) for the data subjects by creating third-party beneficiary rights. See Section 1.3 below as regards this external binding effect.  \n[^23]: For further details, see EDPB Recommendations 01/2020 on measures that supplement transfer tools to ensure compliance with the EU level of protection of personal data, available at https://edpb.europa.eu/our-work-tools/our-documents/recommendations/recommendations-012020-measures-supplement-transfer en.'

    
    
    section = "1.10"
    assert doc.get_heading(section) == "1 INTRODUCTION"
    assert doc.get_text(section, add_markdown_decorators = False) == '1 INTRODUCTION\nHowever, the approval does not include an assessment of whether each processing is in line with all requirements of the GDPR and the BCR. For instance, each data exporter needs to ensure that the requirements set out in Article 6 GDPR (Lawfulness of processing) and Article 28 GDPR (for transfers to processors) or any additional formalities specified by the national law of a Member State, if any, are met for each transfer. Furthermore, it is, for instance, the responsibility of each data exporter to assess, for each transfer, on a case-by-case basis, whether there is a need to implement supplementary measures in order to provide for a level of protection essentially equivalent to the one provided by the GDPR [^8]. Such supplementary measures are in the responsibility of the data exporter, and as such, are not assessed by supervisory authorities (hereinafter "SAs") as part of the process of approval of BCR.\n\n  \n[^8]: See Chapter 3 of these Recommendations, Section 5.4.1, and EDPB Recommendations 01/2020 on measures that supplement transfer tools to ensure compliance with the EU level of protection of personal data, available at https://edpb.europa.eu/our-work-tools/our-documents/recommendations/recommendations-012020-measures- supplement-transfer en.'

